window.APP||function(){APP=function(){var t=!1,e=window.location.pathname.split("/");for(var i in e)if(e[i]!==""&&(t=e[i].charAt(0).toUpperCase()+e[i].slice(1),typeof APP.Routers[t]=="function"))break;var n=t&&APP.Routers[t]?new APP.Routers[t]:new APP.Routers.Default;return n},APP.Models={},APP.Routers={},APP.Collections={},APP.Views={},APP.Layouts={},APP.Templates={}}(this._,this.Backbone),function(t){t.templateSettings={interpolate:/\{\{(.+?)\}\}/g}}(this._,this.Backbone,this.jQuery),function(t,e){APP.Model=e.Model.extend({cache:function(){},isOnline:function(){return t.isUndefined(app)?!0:app.state.online},sync:function(i,n,a){var s={create:"POST",update:"PUT","delete":"DELETE",read:"GET"},o=s[i];a||(a={});var r={type:o,dataType:"json",data:{}};return a.url||(r.url=this.getValue(n,"url")||urlError()),a.data||!n||i!="create"&&i!="update"||(r.contentType="application/json",r.data=JSON.stringify(n.toJSON())),r.type==="GET"||e.emulateJSON||(r.processData=!1),$.ajax(t.extend(r,a))},getValue:function(e,i){return e&&e[i]?t.isFunction(e[i])?e[i]():e[i]:null}}),MongoModel=APP.Model.extend({parse:function(t){return t._id&&(t.id=t._id,delete t._id),t}})}(this._,this.Backbone),function(t,e){APP.Collection=e.Collection.extend({initialize:function(e,i){this.options=i||{},t.isNull(e)&&this.fetch()},attributes:{},add:function(i,n){var a={};return i=t.isArray(i)?i.slice():[i],t.each(i,function(e){t.isUndefined(e.id)?a["add_model_"+Math.random()]=e:t.isUndefined(this.get(e.id))?a[e.id]=e:this.set(e)},this),a=t.toArray(a),e.Collection.prototype.add.call(this,a,n)},set:function(e){var i=this.get(e.id),n=t.extend(i,e);this.remove(i),this.add(n)},update:function(){},setAttr:function(t){for(var e in t)this.attributes[e]=t[e]},getAttr:function(t){return this.attributes[t]},isOnline:function(){return t.isUndefined(app)?!0:app.state.online}}),MongoCollection=APP.Collection.extend({parse:function(t){for(var e in t)t[e].id=t[e]._id,delete t[e]._id;return t}})}(this._,this.Backbone),function(t,e,i){APP.View=e.View.extend({events:{"click a[rel='external']":"clickExternal"},initialize:function(){i(this.el).unbind(),t.bindAll(this,"render","clickExternal","postRender"),this.data=this.model||this.collection||null,t.isUndefined(this.options.type)&&(this.options.type="default"),this.options.attr?i(this.el).attr("data-view",this.options.attr):i(this.el).removeAttr("data-view");var e=this.options.html||null,n={};this.options.url&&(n.url=this.options.url);var a=this.options.template?this.options.template:APP.Template;this.template=new a(e,n),this.template.bind("loaded",this.render),t.isNull(this.data)||(this.data.bind("change",this.render),this.data.bind("reset",this.render),this.data.bind("add",this.render),this.data.bind("remove",this.render)),t.isNull(this.data)||t.isEmpty(this.data.toJSON())||this.render()},render:function(){t.isUndefined(this.preRender)||this.preRender();var e=this.options.type,n=this.template.get(e),a=t.isNull(this.data)?{}:this.data.toJSON();if(!t.isUndefined(n)){var s=n instanceof Function?n(a):n;this.options.append?i(this.el).append(s):i(this.el).html(s)}t.isUndefined(this.postRender)||this.postRender()},postRender:function(){i(this.el).show()},listen:function(t,e,i){var n=typeof e=="string"?[e]:e;for(var a in n)t.bind(n[a],i)},clickExternal:function(t){t.preventDefault();var e=this.findLink(t.target);typeof pageTracker!="undefined"&&(e=pageTracker._getLinkerUrl(e));try{window.plugins.childBrowser.showWebPage(e)}catch(i){window.open(e,"_blank")}return!1},findLink:function(t){return t.tagName!="A"?i(t).closest("a").attr("href"):i(t).attr("href")}})}(this._,this.Backbone,this.jQuery),function(t,e,i){APP.Layout=e.View.extend({events:{},initialize:function(){i(this.el).unbind()}})}(this._,this.Backbone,this.jQuery),function(t,e,i){APP.Template=e.Model.extend({initialize:function(e,i){t.bindAll(this,"fetch","parse"),i||(i={}),t.isEmpty(e)||(this.set("default",this.compile(e)),this.trigger("loaded")),i.url&&(this.url=i.url,this.fetch())},fetch:function(){i.get(this.url,this.parse)},parse:function(t){var e,n=this;try{e=i(t).filter("script")}catch(a){e=[]}e.length?e.each(function(){var t=i(this);t.attr("type").indexOf("template")>=0&&n.set(t.attr("id"),n.compile(t.html()))}):this.set("default",n.compile(t)),this.trigger("loaded")}}),APP.Templates.Markdown=APP.Template.extend({initialize:function(t,e){var i=new Showdown.converter;return this.compile=i.makeHtml,APP.Template.prototype.initialize.call(this,t,e)}})}(this._,this.Backbone,this.jQuery),function(t,e){APP.Router=e.Router.extend({routes:{"_=_":"fb_fix"},initialize:function(){t.bindAll(this,"fb_fix"),this.bind("all",this._trackPageview)},state:{fullscreen:!1,online:navigator.onLine,browser:function(){return $.browser.safari&&/chrome/.test(navigator.userAgent.toLowerCase())?"chrome":/(iPhone|iPod).*OS 5.*AppleWebKit.*Mobile.*Safari/.test(navigator.userAgent)?"ios":"other"},touch:"ontouchstart"in document.documentElement},fb_fix:function(){this.navigate("/",!0)},_trackPageview:function(){var t=e.history.getFragment();typeof _gaq!="undefined"&&_gaq.push(["_trackPageview","/#"+t])}})}(this._,this.Backbone)