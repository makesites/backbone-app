window.APP||function(){APP=function(){var t=arguments[0]||{},e=!1,i=window.location.pathname.split("/");for(var n in i)if(i[n]!==""&&(e=i[n].charAt(0).toUpperCase()+i[n].slice(1),typeof APP.Routers[e]=="function"))break;var s=e&&APP.Routers[e]?new APP.Routers[e](t):new APP.Routers.Default(t);return s},APP.Models={},APP.Routers={},APP.Collections={},APP.Views={},APP.Layouts={},APP.Templates={}}(this._,this.Backbone),function(t){t.templateSettings={interpolate:/\{\{(.+?)\}\}/g}}(this._,this.Backbone,this.jQuery),function(t,e){APP.Model=e.Model.extend({cache:function(){},isOnline:function(){return t.isUndefined(app)?!0:app.state.online},sync:function(i,n,s){var o={create:"POST",update:"PUT","delete":"DELETE",read:"GET"},a=o[i];s||(s={});var r={type:a,dataType:"json",data:{}};return s.url||(r.url=this.getValue(n,"url")||urlError()),s.data||!n||i!="create"&&i!="update"||(r.contentType="application/json",r.data=JSON.stringify(n.toJSON())),r.type==="GET"||e.emulateJSON||(r.processData=!1),$.ajax(t.extend(r,s))},getValue:function(e,i){return e&&e[i]?t.isFunction(e[i])?e[i]():e[i]:null}}),MongoModel=APP.Model.extend({parse:function(t){return t._id&&(t.id=t._id,delete t._id),t}})}(this._,this.Backbone),function(t,e){APP.Collection=e.Collection.extend({initialize:function(e,i){this.options=i||{},t.isNull(e)&&this.fetch()},attributes:{},add:function(i,n){var s={};return i=t.isArray(i)?i.slice():[i],t.each(i,function(e){t.isUndefined(e.id)?s["add_model_"+Math.random()]=e:t.isUndefined(this.get(e.id))?s[e.id]=e:this.set(e)},this),s=t.toArray(s),e.Collection.prototype.add.call(this,s,n)},set:function(e){var i=this.get(e.id),n=t.extend(i,e);this.remove(i),this.add(n)},update:function(){},setAttr:function(t){for(var e in t)this.attributes[e]=t[e]},getAttr:function(t){return this.attributes[t]},isOnline:function(){return t.isUndefined(app)?!0:app.state.online}}),MongoCollection=APP.Collection.extend({parse:function(t){for(var e in t)t[e].id=t[e]._id,delete t[e]._id;return t}})}(this._,this.Backbone),function(t,e,i){APP.View=e.View.extend({events:{"click a[rel='external']":"clickExternal"},initialize:function(){i(this.el).unbind(),t.bindAll(this,"render","clickExternal","postRender"),this.data=this.model||this.collection||null,t.isUndefined(this.options.type)&&(this.options.type="default"),this.options.attr?i(this.el).attr("data-view",this.options.attr):i(this.el).removeAttr("data-view");var e=this.options.html||null,n={};this.options.url&&(n.url=this.options.url);var s=this.options.template?this.options.template:APP.Template;this.template=new s(e,n),this.template.bind("loaded",this.render),t.isNull(this.data)||(this.data.bind("change",this.render),this.data.bind("reset",this.render),this.data.bind("add",this.render),this.data.bind("remove",this.render)),t.isNull(this.data)||t.isEmpty(this.data.toJSON())||this.render()},render:function(){t.isUndefined(this.preRender)||this.preRender();var e=this.options.type,n=this.template.get(e),s=t.isNull(this.data)?{}:this.data.toJSON();if(!t.isUndefined(n)){var o=n instanceof Function?n(s):n;this.options.append?i(this.el).append(o):i(this.el).html(o)}t.isUndefined(this.postRender)||this.postRender()},postRender:function(){i(this.el).show()},listen:function(t,e,i){var n=typeof e=="string"?[e]:e;for(var s in n)t.bind(n[s],i)},clickExternal:function(t){t.preventDefault();var e=this.findLink(t.target);typeof pageTracker!="undefined"&&(e=pageTracker._getLinkerUrl(e));try{window.plugins.childBrowser.showWebPage(e)}catch(i){window.open(e,"_blank")}return!1},findLink:function(t){return t.tagName!="A"?i(t).closest("a").attr("href"):i(t).attr("href")}})}(this._,this.Backbone,this.jQuery),function(t,e,i){APP.Layout=e.View.extend({events:{},initialize:function(){i(this.el).unbind()}})}(this._,this.Backbone,this.jQuery),function(t,e,i){APP.Template=e.Model.extend({initialize:function(e,i){t.bindAll(this,"fetch","parse"),i||(i={}),t.isEmpty(e)||(this.set("default",this.compile(e)),this.trigger("loaded")),i.url&&(this.url=i.url,this.fetch())},fetch:function(){i.get(this.url,this.parse)},parse:function(t){var e,n=this;try{e=i(t).filter("script")}catch(s){e=[]}e.length?e.each(function(){var t=i(this);t.attr("type").indexOf("template")>=0&&n.set(t.attr("id"),n.compile(t.html()))}):this.set("default",n.compile(t)),this.trigger("loaded")}}),APP.Templates.Markdown=APP.Template.extend({initialize:function(t,e){var i=new Showdown.converter;return this.compile=i.makeHtml,APP.Template.prototype.initialize.call(this,t,e)}})}(this._,this.Backbone,this.jQuery),function(t,e){APP.Router=e.Router.extend({options:{},routes:{"_=_":"_fixFB","access_token=:token":"access_token"},initialize:function(e){e=e[0]||{},t.bindAll(this,"access_token","_setup","_ajaxPrefilter","_fixFB"),t.extend(this.options,e),this._setup()},state:{fullscreen:!1,online:navigator.onLine,browser:function(){return $.browser.safari&&/chrome/.test(navigator.userAgent.toLowerCase())?"chrome":/(iPhone|iPod).*OS 5.*AppleWebKit.*Mobile.*Safari/.test(navigator.userAgent)?"ios":"other"},touch:"ontouchstart"in document.documentElement},access_token:function(t){this.session?this.session.set({token:t}):window.access_token=t,this.navigate("/")},_setup:function(){this.options.api&&this._ajaxPrefilter(this.options.api),this.bind("all",this._trackPageview),APP.Session&&(this.session=new APP.Session(this.options.session||{}))},_ajaxPrefilter:function(t){$.ajaxPrefilter(function(e){e.url=t+e.url,e.xhrFields={withCredentials:!0}})},_fixFB:function(){this.navigate("/",!0)},_trackPageview:function(){var t=e.history.getFragment();typeof _gaq!="undefined"&&_gaq.push(["_trackPageview","/#"+t])}})}(this._,this.Backbone)